<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Renamer</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 2rem;
    background: url("/static/invoice_graveyard.png") no-repeat center center fixed;
    background-size: cover;
}

.container {
    background: rgba(255,255,255,0.95);
    padding: 2rem;
    border-radius: 12px;
    max-width: 900px;
    margin: auto;
}

h1 { margin-top: 0; }

.banner {
    font-weight: bold;
    margin-bottom: 1.5rem;
    font-size: 1.1rem;
}

.section {
    margin-top: 2.5rem;
}

.drag-drop-area {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 1.25rem;
    text-align: center;
    cursor: pointer;
    margin-bottom: 1rem;
}

.drag-drop-area.dragover {
    background: #f0f0f0;
}

.file-list {
    list-style: none;
    padding: 0;
    margin-bottom: 1rem;
}

.file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.3rem 0;
    border-bottom: 1px solid #eee;
}

.file-item button {
    background: none;
    border: none;
    color: red;
    font-size: 1.1rem;
    cursor: pointer;
}

button.submit-btn {
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    cursor: pointer;
}

.status {
    margin-top: 0.5rem;
}
</style>
</head>

<body>
<div class="container">

<h1>PDF Renamer</h1>

<div class="banner">
    As your files get renamed, take a moment to remember how amazing Justin is ðŸ˜„
</div>

<div id="sections"></div>

</div>

<script>
function createUploader(title, endpoint) {
    const files = [];
    const section = document.createElement("div");
    section.className = "section";

    section.innerHTML = `
        <h2>${title}</h2>
        <div class="drag-drop-area">Drag & drop PDFs here or click to select files</div>
        <input type="file" accept="application/pdf" multiple hidden>
        <ul class="file-list"></ul>
        <button class="submit-btn" disabled>Upload and Rename</button>
        <div class="status"></div>
    `;

    const dropArea = section.querySelector(".drag-drop-area");
    const input = section.querySelector("input");
    const list = section.querySelector(".file-list");
    const button = section.querySelector("button");
    const status = section.querySelector(".status");

    function render() {
        list.innerHTML = "";
        files.forEach((f, i) => {
            const li = document.createElement("li");
            li.className = "file-item";
            li.innerHTML = `<span>${f.name}</span><button>âœ•</button>`;
            li.querySelector("button").onclick = () => {
                files.splice(i, 1);
                render();
            };
            list.appendChild(li);
        });
        button.disabled = files.length === 0;
    }

    function addFiles(newFiles) {
        for (const f of newFiles) {
            if (!files.some(x => x.name === f.name && x.size === f.size)) {
                files.push(f);
            }
        }
        render();
    }

    ["dragenter","dragover"].forEach(e =>
        dropArea.addEventListener(e, ev => {
            ev.preventDefault();
            dropArea.classList.add("dragover");
        })
    );

    ["dragleave","drop"].forEach(e =>
        dropArea.addEventListener(e, ev => {
            ev.preventDefault();
            dropArea.classList.remove("dragover");
        })
    );

    dropArea.onclick = () => input.click();
    dropArea.ondrop = e => addFiles(e.dataTransfer.files);
    input.onchange = () => addFiles(input.files);

    button.onclick = async () => {
        status.textContent = "Uploading...";
        const fd = new FormData();
        files.forEach(f => fd.append("files", f));

        const res = await fetch(endpoint, { method: "POST", body: fd });
        const blob = await res.blob();

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "renamed_files.zip";
        a.click();
        URL.revokeObjectURL(url);

        status.textContent = "Done!";
    };

    return section;
}

const container = document.getElementById("sections");

container.appendChild(createUploader("Rename by Customer Number", "/upload"));
container.appendChild(createUploader("Rename by Invoice Number", "/upload_invoice"));
container.appendChild(createUploader("Rename Sales Order", "/upload_salesorder"));
</script>

</body>
</html>
